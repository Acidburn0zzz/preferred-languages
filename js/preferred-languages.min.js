(function(wp,settings,$){var $activeLocales=$(".active-locales-list"),$activeLocalesControls=$(".active-locales-controls"),$inactiveLocales=$(".inactive-locales-list"),$inactiveLocalesControls=$(".inactive-locales-controls"),$selectedLocale=$activeLocales.find('li[aria-selected="true"]'),$inputField=$('input[name="preferred_languages"]');function changeButtonState(activeLocale){$activeLocalesControls.find(".locales-move-up").attr("disabled",0===activeLocale.index());$activeLocalesControls.find(".locales-move-down").attr("disabled",activeLocale.index()===$activeLocales.children("li").length-1);$activeLocalesControls.find(".locales-remove").attr("disabled",1===$activeLocales.children("li").length)}function toggleLocale(locale){var selected=locale.attr("aria-selected"),newState=!!selected;if(true===selected){return}$selectedLocale.attr("aria-selected",false);locale.attr("aria-selected",newState);if(true===newState){$selectedLocale=locale;$activeLocales.attr("aria-activedescendant",$selectedLocale.attr("id"))}changeButtonState(locale)}function updateHiddenInput(){var locales=[];$activeLocales.children("li").each(function(){locales.push($(this).attr("id"))});$inputField.val(locales.join(","))}function moveLocaleUp(){$selectedLocale.insertBefore($selectedLocale.prev());updateHiddenInput();changeButtonState($selectedLocale);wp.a11y.speak(settings.l10n.movedUp)}function moveLocaleDown(){$selectedLocale.insertAfter($selectedLocale.next());updateHiddenInput();changeButtonState($selectedLocale);wp.a11y.speak(settings.l10n.movedDown)}function removeActiveLocale(){var locale=$selectedLocale.attr("id"),$successor;if(1===$activeLocales.children("li").length){return}$successor=$selectedLocale.prev();if(0===$successor.length){$successor=$selectedLocale.next()}$selectedLocale.remove();toggleLocale($successor);changeButtonState($selectedLocale);updateHiddenInput();if("en_US"===locale){locale=""}$inactiveLocales.find('select option[value="'+locale+'"]').removeClass("hidden");wp.a11y.speak(settings.l10n.localeRemoved)}function makeLocaleActive(option){var $newLocale=$("<li/>",{id:option.val()||"en_US",text:option.text(),"aria-selected":false}),$successor;$successor=option.prev(":not(.hidden)");if(0===$successor.length){$successor=option.next(":not(.hidden)")}if(0===$successor.length){$successor=$inactiveLocales.find("option").first()}$successor.attr("selected",true);$inactiveLocalesControls.val($successor.val());option.removeAttr("selected").addClass("hidden");if($activeLocales.find("#"+(option.val()||"en_US")).length>0){return}$activeLocales.append($newLocale);toggleLocale($newLocale);$activeLocales.animate({scrollTop:$newLocale.offset().top-$activeLocales.offset().top+$activeLocales.scrollTop()});updateHiddenInput();wp.a11y.speak(settings.l10n.localeAdded)}$(".user-language-wrap").remove();$("#WPLANG").parent().parent().remove();changeButtonState($selectedLocale);$.each($inputField.val().split(","),function(index,value){value="en_US"===value?"":value;makeLocaleActive($inactiveLocales.find('[value="'+value+'"]'))});$activeLocales.sortable({axis:"y",cursor:"move"});$activeLocales.on("keydown",function(e){if(38===e.which){if(e.altKey){moveLocaleUp()}else{$selectedLocale.prev().length&&toggleLocale($selectedLocale.prev())}e.preventDefault()}if(40===e.which){if(e.altKey){moveLocaleDown()}else{$selectedLocale.next().length&&toggleLocale($selectedLocale.next())}e.preventDefault()}if(8===e.which){removeActiveLocale();e.preventDefault()}});$inactiveLocalesControls.find(".locales-add").on("click",function(){makeLocaleActive($inactiveLocales.find("select option:selected"))});$activeLocales.on("click","li",function(){toggleLocale($(this))});$activeLocalesControls.find(".locales-move-up").on("click",moveLocaleUp);$activeLocalesControls.find(".locales-move-down").on("click",moveLocaleDown);$activeLocalesControls.find(".locales-remove").on("click",removeActiveLocale)})(wp,preferredLanguages,jQuery);